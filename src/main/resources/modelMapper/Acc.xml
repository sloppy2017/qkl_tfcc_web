<?xml version="1.0" encoding="UTF-8" ?>  
    <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Acc">

  
    <!--查询可用余额 -->
	<select id="getAvailableBalance" parameterType="com.qkl.tfcc.api.po.acc.Acc" resultType="java.lang.Integer">
	       select avb_amnt from tb_acc where user_code = #{userCode} and sub_acc_no = #{subAccno}
	</select>
	
	<insert id="addAcc" parameterType="com.qkl.tfcc.api.po.acc.Acc" >
	 insert into tb_acc (
	 user_code,
	 sub_acc_no,
	 avb_amnt,
	 froze_amnt,
	 total_amnt,
	 last_caldate,
	 syscode,
	 create_time,
	 modify_time,m
	 operator)
	 values(
	 #{userCode},
	 #{subAccno},
	 #{avbAmnt},
	 #{frozeAmnt},
	 #{totalAmnt},
	 #{lastCaldate},
	 #{syscode},
	 #{createTime},
	 #{modifyTime},
	 #{operator}
	 )	 
	 </insert>
<!-- 	 获取奖励 -->
	 <update id="updateIn" parameterType="com.qkl.tfcc.api.po.acc.Acc">    
         update tb_acc 
         <set> 
                avb_amnt = avb_amnt + #{avbAmnt},
                total_amnt = total_amnt + #{avbAmnt},
                last_caldate = now(),
                modify_time = now(),
           <if test="operator != null and operator != ''">
                operator = #{operator}
           </if>     
         </set>
         where user_code = #{userCode}     
               and sub_acc_no = #{subAccno}
               and syscode = #{syscode}
     </update>
<!--      发放奖励 -->
     <update id="updateOut" parameterType="com.qkl.tfcc.api.po.acc.Acc">    
         update tb_acc 
         <set> 
                avb_amnt = avb_amnt - #{avbAmnt},
                total_amnt = total_amnt - #{avbAmnt},
                last_caldate = now(),
                modify_time = now(),
           <if test="operator != null and operator != ''">
                operator = #{operator}
           </if>     
         </set>
         where user_code = #{userCode}     
               and sub_acc_no = #{subAccno}
               and syscode = #{syscode}
     </update>
<!--      发放奖励 -->
     <update id="updatefroze" parameterType="pd">    
        update tb_acc a,tb_unfreeze_detail b,tb_user c
         <set> 
                a.avb_amnt = a.avb_amnt +b.unfreeze_num,
   			  a.froze_amnt = a.froze_amnt - b.unfreeze_num,
                a.last_caldate = now(),
                a.modify_time = now(),
           <if test="operator != null and operator != ''">
                operator = #{operator}
           </if>     
         </set>
         where a.user_code =b.user_code     
               and a.sub_acc_no = b.sub_acc_no
               and a.syscode = b.syscode
               and a.user_code = c.user_code
               and c.user_type =#{userType}
               and b.syscode = #{syscode}
               and b.status ='0'
     </update>     
     
     
     <select id="findAcc" parameterType="com.qkl.tfcc.api.po.acc.Acc" resultType="com.qkl.tfcc.api.po.acc.Acc">
           select * from tb_acc 
           where user_code = #{userCode} 
           <if test="subAccno != null and subAccno !='' ">
                and sub_acc_no = #{subAccno}
           </if>
           <if test="syscode != null and syscode !='' ">
                and syscode = #{syscode}
           </if>
     </select>
	 
		 

</mapper>     
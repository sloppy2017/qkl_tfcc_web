<?xml version="1.0" encoding="UTF-8" ?>  
    <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ComAccMy">

     <!-- 查询TFCC余额 -->
    <select id="findTB" parameterType="java.lang.String" resultType="java.math.BigDecimal" >
		        <!-- select sum(amnt) tfcc
		        from tb_acc_def d , tb_acc_detail a 
		        where d.sub_accno=a.sub_accno 
		        and cuy_type='1' 
		        and user_type='1'
		        and user_code=#{userCode}  -->
		        select avb_amnt tfcc from tb_acc where user_code=#{userCode}
	</select> 
	
     <!-- 查询JFCC余额 -->
     <select id="findJB" parameterType="java.lang.String" resultType="java.math.BigDecimal" >
			select sum(amnt) jfcc
			from tb_acc_def d , tb_acc_detail a 
			where d.sub_accno=a.sub_accno 
			and cuy_type='2' 
			and user_type='1' 
			and user_code=#{userCode}
	 </select> 
	 
	 <!-- 查询我累计推荐会员奖励的TFCC -->
	 <select id="findReward"  parameterType="java.lang.String" resultType="java.math.BigDecimal" > 
		<!--  select sum(amnt) mtfcc
		 from tb_acc_def f,tb_acc_detail d  
		 where  f.sub_accno=d.sub_accno 
		 and acc_type='1' 
		 and cuy_type='1' 
		 and d.bouns_source1='11' 
		 and d.user_code=#{userCode} -->
		 select sum(amnt) mtfcc from tb_acc_detail where bouns_source1='11' and user_code=#{userCode}
	 </select>
	
	 <!-- 查询我累计推荐网点奖励的TFCC -->
	 <select id="findWReward"  parameterType="java.lang.String" resultType="java.math.BigDecimal" > 
	     select sum(amnt) wtfcc
	     from tb_acc_def f,tb_acc_detail d  
	     where  f.sub_accno=d.sub_accno 
	     and acc_type='1' 
	     and cuy_type='1' 
	     and d.bouns_source1='12' 
	     and d.user_code=#{userCode}
     </select>
    
     <!-- 查询我总计奖励的TFCC -->
     <select id="findTTReward"  parameterType="java.lang.String" resultType="java.math.BigDecimal" > 
       <!--  select sum(amnt) ttfcc
         from tb_acc_def f,tb_acc_detail d  
         where  f.sub_accno=d.sub_accno 
         and acc_type='1' 
         and cuy_type='1' 
         and d.user_code=#{userCode} -->
         
         select sum(amnt) ttfcc from tb_acc_detail where user_code=#{userCode}
     </select>
     
      <!-- 查询列表 -->
     <select id="findAllPage" parameterType="page"  resultType="pd" >
	 select caldate rewardDate,sum(lvajl) aReward,sum(lvbjl) bReward,sum(lvcjl) cReward from 
	(select date_format(caldate,'%Y-%m-%d') caldate,user_code,
			case when bouns_source2='1101' then amnt else 0 end lvajl ,
			case when bouns_source2='1102' then amnt else 0 end lvbjl ,
			case when bouns_source2='1103' then amnt else 0 end lvcjl 
	from tb_acc_detail ) a
	where a.user_code=#{userCode}
	group by caldate;
 
    </select>
    
    <select id="getAmnt" parameterType="pd" resultType="pd">
        select * from tb_acc where user_code = #{user_code}
    </select>
</mapper>     